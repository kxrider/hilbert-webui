{% extends 'base.html' %}
{% block title %}Hilbert Web-UI{% endblock %}
{% block content %}<h1>This is the homepage</h1>

<div id="terminal"></div>
	  <script>
		var term = new Terminal({
		});
		const ws = new WebSocket("ws://localhost:3000", "echo-protocol");
		var curr_line= "";
		var entries= [];
		term.setOption('fontSize', 15);
		term.setOption('cursorBlink', true);
		term.setOption('cursorStyle', 'bar');
		//term.setOption('cols' 'rows', 50 20);
		term.open(document.getElementById("terminal"));
		term.write("HilbertServer-$: ");
		
		term.prompt = () => {
			if (curr_line) {
				let data = { method: "command", command: curr_line};
				ws.send(JSON.stringify(data));
			}
		};
		term.prompt();
		
		ws.onmessage = msg => {
			term.write("\r\n" + JSON.parse(msg.data).data);
			curr_line = "";
		};
		
		term.on("key", function(key, ev){
			if (ev.keyCode === 13) {
				if (curr_line){
					entries.push(curr_line);
					term.write("\r\n");
					term.prompt();
				}
			}else if (ev.keyCode === 8){
				if (curr_line) {
					curr_line = curr_line.slice(0, curr_line.length - 1);
					term.write("\b \b");
				}
			}else{
				curr_line += key;
				term.write(key);
			}
			term.on("paste", function(data) {
				curr_line += data;
				term.write(data);
			});
		});
	  </script>
{% endblock %}
